[TOC]

# 第1章 计算机网络基础篇

要摸清网络，那么第一步肯定是要清楚网络协议的分层结构，看分层结构相当于从上帝视角来看网络，这样后续针对每一个层深入学习就不会摸不着头脑。



对于同一台设备上的进程间通信，有很多种方式，比如有管道、消息队列、共享内存、信号等方式，而对于不同设备上的进程间通信，就需要网络通信，而设备是多样性的，所以要兼容多种多样的设备，就协商出了一套**通用的网络协议**。

## OSI 标准模型

OSI(Open System Interconnect),即开放式系统互联。

互联⽹的通信协议都对应了 7 层中的某⼀层，通过这⼀点，可以了解协议在整个⽹络模型中的作⽤，⼀般来说，各个分层的主要作⽤如下

![image.png](计算机网络.assets/1634275679985-6620f2fe-94c5-49ac-b693-b133ddd16090.png)

**应⽤层** ：应⽤层是 OSI 标准模型的最顶层，是直接为应⽤进程提供服务的。其作⽤是在实现多个系统应⽤进

程相互通信的同时，完成⼀系列业务处理所需的服务。包括⽂件传输、电⼦邮件远程登录和远端接⼝调⽤等

协议。



**表示层** : 表示层向上对应⽤进程服务，向下接收会话层提供的服务，表示层位于 OSI 标准模型的第六层，表

示层的主要作⽤就是将设备的固有数据格式转换为⽹络标准传输格式。



**会话层** ：会话层位于 OSI 标准模型的第五层，它是建⽴在传输层之上，利⽤传输层提供的服务建⽴和维持会

话。



**传输层** ：传输层位于 OSI 标准模型的第四层，它在整个 OSI 标准模型中起到了⾄关重要的作⽤。传输层涉

及到两个节点之间的数据传输，向上层提供可靠的数据传输服务。传输层的服务⼀般要经历传输连接建⽴阶

段，数据传输阶段，传输连接释放阶段 3 个阶段才算完成⼀个完整的服务过程。



**⽹络层** ：⽹络层位于 OSI 标准模型的第三层，它位于传输层和数据链路层的中间，将数据设法从源端经过若

⼲个中间节点传送到另⼀端，从⽽向运输层提供最基本的端到端的数据传送服务。



**数据链路层** ：数据链路层位于物理层和⽹络层中间，数据链路层定义了在单个链路上如何传输数据。



**物理层** ：物理层是 OSI 标准模型中最低的⼀层，物理层是整个 OSI 协议的基础，就如同房屋的地基⼀样，

物理层为设备之间的数据通信提供传输媒体及互连设备，为数据传输提供可靠的环境。

## TCP/IP ⽹络模型

TCP/IP网络协议通常是由上到下，分成 5 层，分别是应用层、传输层、网络层、数据链路层和物理层。

![img](计算机网络.assets/1634268505511-d883dec1-b4b0-4f1d-857b-dde5af1e5899.webp)

这个网络协议是分层的，每一层都有各自的作用和职责，接下来就分别对每一层进行介绍。

## 应用层

最上层的，也是我们能直接接触到的就是**应用层**（*Application Layer*），我们电脑或手机使用的应用软件都是在应用层实现。那么，当两个不同设备的应用需要通信的时候，应用就把应用数据传给下一层，也就是传输层。



所以，应用层只需要专注于为用户提供应用功能，不用去关心数据是如何传输的，就类似于，我们寄快递的时候，只需要把包裹交给快递员，由他负责运输快递，我们不需要关心快速是如何被运输的。



而且应用层是工作在操作系统中的用户态，传输层及以下则工作在内核态。

## 传输层

应用层的数据包会传给传输层，**传输层**（**Transport Layer**）是为应用层提供网络支持的。

![img](计算机网络.assets/1634268267392-643990df-bd8e-44be-9ac1-202302e09282.webp)

在传输层会有两个传输协议，分别是 TCP 和 UDP。

TCP 的全称叫传输层控制协议（*Transmission Control Protocol*），大部分应用使用的正是 TCP 传输层协议，比如 HTTP 应用层协议。TCP 相比 UDP 多了很多特性，比如流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠地传输给对方。 



UDP 就相对很简单，简单到只负责发送数据包，不保证数据包是否能抵达对方，但它实时性相对更好，传输效率也高。当然，UDP 也可以实现可靠传输，把 TCP 的特性在应用层上实现就可以，不过要实现一个商用的可靠 UDP 传输协议，也不是一件简单的事情。



应用需要传输的数据可能会非常大，如果直接传输就不好控制，因此当传输层的数据包大小超过 MSS（TCP 最大报文段长度） ，就要将数据包分块，这样即使中途有一个分块丢失或损坏了，只需要重新这一个分块，而不用重新发送整个数据包。在 TCP 协议中，我们把每个分块称为一个 **TCP 段**（*TCP Segment*）。

![img](计算机网络.assets/1634268287934-1c8b5d68-ba97-44fe-8f37-5789ba1d4e32.webp)

当设备作为接收方时，传输层则要负责把数据包传给应用，但是一台设备上可能会有很多应用在接收或者传输数据，因此需要用一个编号将应用区分开来，这个编号就是**端口**。



比如 80 端口通常是 Web 服务器用的，22 端口通常是远程登录服务器用的。而对于浏览器（客户端）中的每个标签栏都是一个独立的进程，操作系统会为这些进程分配临时的端口号。



由于传输层的报文中会携带端口号，因此接收方可以识别出该报文是发送给哪个应用。

## 网络层

网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输。



传输层可能大家刚接触的时候，会认为它负责将数据从一个设备传输到另一个设备，事实上它并不负责。



实际场景中的网络环节是错综复杂的，中间有各种各样的线路和分叉路口，如果一个设备的数据要传输给另一个设备，就需要在各种各样的路径和节点进行选择，而传输层的设计理念是简单、高效、专注，如果传输层还负责这一块功能就有点违背设计原则了。



也就是说，我们不希望传输层协议处理太多的事情，只需要服务好应用即可，让其作为应用间数据传输的媒介，帮助实现应用到应用的通信，而实际的传输功能就交给下一层，也就是**网络层**（*Internet Layer*）。

![img](计算机网络.assets/1634268325662-65b14a91-4225-488e-b025-320e9052cf20.webp)

网络层最常使用的是 IP 协议（*Internet Protocol*），IP 协议会将传输层的报文作为数据部分，再加上 IP 包头组装成 IP 报文，如果 IP 报文大小超过 MTU（以太网中一般为 1500 字节）就会**再次进行分片**，得到一个即将发送到网络的 IP 报文。

![img](计算机网络.assets/1634268340221-a1ba5515-acf3-4049-93a2-6c8bd0466ba4.webp)

网络层负责将数据从一个设备传输到另一个设备，世界上那么多设备，又该如何找到对方呢？因此，网络层需要有区分设备的编号。



我们一般用 IP 地址给设备进行编号，对于 IPv4 协议， IP 地址共 32 位，分成了四段，每段是 8 位。只有一个单纯的 IP 地址虽然做到了区分设备，但是寻址起来就特别麻烦，全世界那么多台设备，难道一个一个去匹配？这显然不科学。



因此，需要将 IP 地址分成两种意义：

- 一个是**网络号**，负责标识该 IP 地址是属于哪个子网的；
- 一个是**主机号**，负责标识同一子网下的不同主机；



怎么分的呢？这需要配合**子网掩码**才能算出 IP 地址 的网络号和主机号。那么在寻址的过程中，先匹配到相同的网络号，才会去找对应的主机。

除了寻址能力， IP 协议还有另一个重要的能力就是**路由**。实际场景中，两台设备并不是用一条网线连接起来的，而是通过很多网关、路由器、交换机等众多网络设备连接起来的，那么就会形成很多条网络的路径，因此当数据包到达一个网络节点，就需要通过算法决定下一步走哪条路径。



所以，**IP 协议的寻址作用是告诉我们去往下一个目的地该朝哪个方向走，路由则是根据「下一个目的地」选择路径。寻址更像在导航，路由更像在操作方向盘**。

## 数据链路层

实际场景中，网络并不是一个整体，比如你家和我家就不属于一个网络，所以数据不仅可以在同一个网络中设备间进行传输，也可以跨网络进行传输。



一旦数据需要跨网络传输，就需要有一个设备同时在两个网络当中，这个设备一般是路由器，路由器可以通过路由表计算出下一个要去的 IP 地址。



那问题来了，路由器怎么知道这个 IP 地址是哪个设备的呢？

于是，就需要有一个专门的层来标识网络中的设备，让数据在一个链路中传输，这就是**数据链路层**（*Data Link Layer*），它主要为网络层提供链路级别传输的服务。

![img](计算机网络.assets/1634268449474-415498e6-143c-4442-b43c-b9320f265cca.webp)

每一台设备的网卡都会有一个 MAC 地址，它就是用来唯一标识设备的。路由器计算出了下一个目的地 IP 地址，再通过 ARP 协议找到该目的地的 MAC 地址，这样就知道这个 IP 地址是哪个设备的了。



链路：就是从一个节点到相邻节点的一段物理线路，而中间没有任何其他的交换节点。

数据链路：就是吧实现通信协议的硬件和软件加到链路上，就构成了数据链路。

数据链路层以帧为单位传输和处理数据。

## 物理层

当数据准备要从设备发送到网络时，需要把数据包转换成电信号，让其可以在物理介质中传输，这一层就是**物理层**（*Physical Layer*），它主要是为数据链路层提供二进制传输的服务。



物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流



物理层为数据链路层屏蔽了各种传输媒体的差异，是数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体是什么

![img](计算机网络.assets/1634268478160-dc6f4dba-7cc9-4b0d-aee5-520cfb5608a1.webp)

### 物理媒介

⽹络的传输是需要介质的。⼀个⽐特数据包从⼀个端系统开始传输，经过⼀系列的链路和路由器，从⽽到达另外⼀个端系统。这个⽐特会被转发了很多次，那么这个⽐特经过传输的过程所跨越的媒介就被称为 物理媒介(phhysical medium) ，物理媒介有很多种，⽐如双绞铜线、同轴电缆、多模光纤榄、陆地⽆线电频谱和卫星⽆线电频谱。其实⼤致分为两种：引导性媒介和⾮引导性媒介。

**双绞铜线**

最便宜且最常⽤的引导性传输媒介就是 双绞铜线 ，多年以来，它⼀直应⽤于电话⽹。从电话机到本地电话交换机的连线超过 99% 都是使⽤的双绞铜线，例如下⾯就是双绞铜线的实物图

![image.png](计算机网络.assets/1634269782533-cf106b2f-a765-4995-a7e1-c4c7ca7da0d4.png)

双绞铜线由两根绝缘的铜线组成，每根⼤约 1cm 粗，以规则的螺旋形状排列，通常许多双绞线捆扎在⼀起形成电缆，并在双绞馅的外⾯套上保护层。⼀对电缆构成了⼀个通信链路。 ⽆屏蔽双绞线 ⼀般常⽤在局域⽹（LAN）中。



**同轴电缆**

与双绞线类似，同轴电缆也是由两个铜导体组成，下⾯是实物图

![image.png](计算机网络.assets/1634274471243-6c9f4024-49cb-415a-b037-1df373e49181.png)

借助于这种结构以及特殊的绝缘体和保护层，同轴电缆能够达到较⾼的传输速率，同轴电缆普遍应⽤在在电缆电视系统中。同轴电缆常被⽤户引导型共享媒介。



**光纤**

光纤是⼀种细⽽柔软的、能够引导光脉冲的媒介，每个脉冲表示⼀个⽐特。⼀根光纤能够⽀持极⾼的⽐特率，⾼达数⼗甚⾄数百 Gbps。它们不受电磁⼲扰。光纤是⼀种引导型物理媒介，下⾯是光纤的实物图

![image.png](计算机网络.assets/1634274507993-6fffef75-ce5f-48c4-b1cf-78d3bbe387f5.png)

⼀般⻓途电话⽹络全⾯使⽤光纤，光纤也⼴泛应⽤于因特⽹的主⼲。



**陆地⽆线电信道**

⽆线电信道承载电磁频谱中的信号。它不需要安装物理线路，并具有穿透墙壁、提供与移动⽤户的连接以及⻓距离承载信号的能⼒。



**卫星⽆线电信道**

⼀颗卫星电信道连接地球上的两个或多个微博发射器/接收器，它们称为地⾯站。通信中经常使⽤两类卫星：同步卫星和近地卫星。

# 第2章 计算机网络之HTTP

